<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    body {
      width: 450px;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      margin: 0;
    }

    h2 {
      margin: 0 0 16px 0;
      font-size: 18px;
      color: #333;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    /* Tab Navigation */
    .tab-nav {
      display: flex;
      background: #f5f5f5;
      border-bottom: 1px solid #ddd;
    }

    .tab-btn {
      flex: 1;
      padding: 12px 8px;
      border: none;
      background: transparent;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      color: #666;
      transition: all 0.2s;
      border-bottom: 2px solid transparent;
    }

    .tab-btn:hover {
      background: #e8e8e8;
      color: #333;
    }

    .tab-btn.active {
      color: #4CAF50;
      border-bottom-color: #4CAF50;
      background: white;
    }

    /* Tab Content */
    .tab-content {
      display: none;
      padding: 16px;
    }

    .tab-content.active {
      display: block;
    }

    /* Buttons */
    .btn {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      margin-bottom: 8px;
      transition: all 0.2s;
    }

    .btn-primary {
      background: #4CAF50;
      color: white;
    }

    .btn-primary:hover {
      background: #45a049;
    }

    .btn-primary:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .btn-secondary {
      background: #f5f5f5;
      color: #333;
    }

    .btn-secondary:hover {
      background: #e0e0e0;
    }

    /* Status Messages */
    .status {
      padding: 12px;
      border-radius: 8px;
      font-size: 13px;
      margin-top: 8px;
      display: none;
    }

    .status.success {
      background: #e8f5e9;
      color: #2e7d32;
      display: block;
    }

    .status.error {
      background: #ffebee;
      color: #c62828;
      display: block;
    }

    .page-info {
      font-size: 12px;
      color: #666;
      padding: 8px;
      background: #f5f5f5;
      border-radius: 6px;
      margin-bottom: 12px;
    }

    .proxy-status {
      font-size: 11px;
      padding: 6px 10px;
      border-radius: 4px;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 4px;
    }

    .proxy-status.connected {
      background: #e8f5e9;
      color: #2e7d32;
      border: 1px solid #c8e6c9;
    }

    .proxy-status.disconnected {
      background: #fff3e0;
      color: #e65100;
      border: 1px solid #ffe0b2;
    }

    /* Route Planner Styles */
    .section-title {
      font-size: 14px;
      font-weight: 600;
      color: #333;
      margin: 16px 0 12px 0;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .form-group {
      margin-bottom: 12px;
    }

    .form-row {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
    }

    .form-col {
      flex: 1;
    }

    .form-col.small {
      flex: 0 0 80px;
    }

    label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      color: #555;
      margin-bottom: 4px;
    }

    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 8px 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 13px;
      box-sizing: border-box;
      transition: border-color 0.2s;
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
      outline: none;
      border-color: #4CAF50;
    }

    input.error {
      border-color: #c62828;
    }

    .map-toggle {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 10px;
      background: #e3f2fd;
      border: 1px dashed #2196F3;
      border-radius: 6px;
      color: #1976D2;
      font-size: 13px;
      cursor: pointer;
      transition: all 0.2s;
      margin-top: 8px;
    }

    .map-toggle:hover {
      background: #bbdefb;
    }

    /* Progress Bar */
    .progress-container {
      margin-top: 16px;
      display: none;
    }

    .progress-bar {
      width: 100%;
      height: 8px;
      background: #e0e0e0;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 12px;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #4CAF50, #66BB6A);
      transition: width 0.3s;
      width: 0%;
    }

    .progress-text {
      font-size: 12px;
      color: #666;
      text-align: center;
      margin-bottom: 8px;
    }

    /* Address List */
    .address-list {
      margin-top: 12px;
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      display: none;
    }

    .address-item {
      padding: 8px 10px;
      border-bottom: 1px solid #e0e0e0;
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .address-item:last-child {
      border-bottom: none;
    }

    .status-icon {
      width: 16px;
      height: 16px;
      flex-shrink: 0;
    }

    .status-icon.pending {
      color: #9e9e9e;
    }

    .status-icon.processing {
      color: #2196F3;
    }

    .status-icon.success {
      color: #4CAF50;
    }

    .status-icon.error {
      color: #c62828;
    }

    .address-text {
      flex: 1;
    }

    .customer-info {
      font-size: 11px;
      color: #666;
      margin-top: 2px;
    }

    /* PDF Section */
    .pdf-section {
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid #e0e0e0;
      display: none;
    }

    .pdf-ready {
      background: #e8f5e9;
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 12px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .pdf-ready-icon {
      font-size: 20px;
    }

    .pdf-ready-text {
      flex: 1;
      font-size: 13px;
      color: #2e7d32;
      font-weight: 500;
    }

    /* Helper Classes */
    .hidden {
      display: none !important;
    }

    .error-message {
      font-size: 11px;
      color: #c62828;
      margin-top: 4px;
      display: none;
    }

    /* Scrollbar Styling */
    .address-list::-webkit-scrollbar {
      width: 6px;
    }

    .address-list::-webkit-scrollbar-track {
      background: #f5f5f5;
    }

    .address-list::-webkit-scrollbar-thumb {
      background: #bdbdbd;
      border-radius: 3px;
    }

    .address-list::-webkit-scrollbar-thumb:hover {
      background: #9e9e9e;
    }

    /* Map View Styles */
    .map-view-container {
      margin-top: 12px;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      overflow: hidden;
    }

    .map-view-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 10px 12px;
      background: #f5f5f5;
      border-bottom: 1px solid #e0e0e0;
    }

    .map-view-title {
      font-size: 13px;
      font-weight: 500;
      color: #333;
    }

    .map-view-controls {
      display: flex;
      gap: 8px;
      padding: 8px 12px;
      background: #fafafa;
      border-bottom: 1px solid #e0e0e0;
    }

    .btn-small {
      padding: 4px 10px;
      font-size: 11px;
      border: 1px solid #ddd;
      border-radius: 4px;
      background: white;
      cursor: pointer;
      transition: all 0.2s;
    }

    .btn-small:hover:not(:disabled) {
      background: #f0f0f0;
    }

    .btn-small:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .selected-count {
      margin-left: auto;
      font-size: 11px;
      color: #666;
      align-self: center;
    }

    .map {
      width: 100%;
      height: 300px;
      background: #e0e0e0;
    }

    .map-addresses-list {
      max-height: 120px;
      overflow-y: auto;
      padding: 8px;
    }

    .map-address-item {
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 6px 8px;
      background: #f5f5f5;
      border-radius: 4px;
      margin-bottom: 4px;
      font-size: 11px;
    }

    .map-address-item:last-child {
      margin-bottom: 0;
    }

    .map-address-remove {
      color: #c62828;
      cursor: pointer;
      font-weight: bold;
      padding: 0 4px;
    }

    .map-address-remove:hover {
      color: #e53935;
    }
  </style>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="lib/leaflet.css">
</head>
<body>
  <!-- Tab Navigation -->
  <div class="tab-nav">
    <button class="tab-btn active" data-tab="autofill">Auto-Fill</button>
    <button class="tab-btn" data-tab="route-planner">Route Planner</button>
    <button class="tab-btn" data-tab="settings">‚öôÔ∏è</button>
  </div>

  <!-- Auto-Fill Tab -->
  <div id="autofill-tab" class="tab-content active">
    <h2>üìã SCE Auto-Fill</h2>

    <div id="pageInfo" class="page-info">Detecting page...</div>

    <button id="fillBtn" class="btn btn-primary">Fill Form</button>

    <div id="status" class="status"></div>
  </div>

  <!-- Route Planner Tab -->
  <div id="route-planner-tab" class="tab-content">
    <h2>üìç Route Planner</h2>

    <!-- Address Range Generator -->
    <div class="section-title">
      <span>üè†</span> Generate Route from Address Range
    </div>

    <div class="form-group">
      <label for="startAddress">Start Address</label>
      <input type="text" id="startAddress" placeholder="1909 W Martha Ln">
      <div class="error-message" id="startAddressError"></div>
    </div>

    <div class="form-group">
      <label for="endAddress">End Address</label>
      <input type="text" id="endAddress" placeholder="1925 W Martha Ln">
      <div class="error-message" id="endAddressError"></div>
    </div>

    <div class="form-row">
      <div class="form-col">
        <label for="city">City</label>
        <input type="text" id="city" placeholder="Santa Ana">
      </div>
      <div class="form-col small">
        <label for="state">State</label>
        <select id="state">
          <option value="CA">CA</option>
          <option value="Other">Other</option>
        </select>
      </div>
      <div class="form-col small">
        <label for="zip">ZIP</label>
        <input type="text" id="zip" placeholder="92706" maxlength="5">
      </div>
    </div>

    <div class="form-row">
      <div class="form-col">
        <label for="side">Side</label>
        <select id="side">
          <option value="both">Both</option>
          <option value="odd">Odd Only</option>
          <option value="even">Even Only</option>
        </select>
      </div>
      <div class="form-col">
        <label for="skip">Skip (comma-separated)</label>
        <input type="text" id="skip" placeholder="1915, 1921">
      </div>
    </div>

    <div class="map-toggle" id="mapToggle">
      üó∫Ô∏è Use Map View - Click houses to add
    </div>

    <!-- Map View Container (hidden by default) -->
    <div id="mapViewContainer" class="map-view-container hidden">
      <div class="map-view-header">
        <span class="map-view-title">Click map to add addresses</span>
        <button class="btn-small" id="closeMapBtn">‚úï Close Map</button>
      </div>

      <div class="map-view-controls">
        <button class="btn-small btn-secondary" id="undoMarkerBtn" disabled>‚Ü∂ Undo Last</button>
        <button class="btn-small btn-secondary" id="clearMarkersBtn">Clear All</button>
        <span class="selected-count" id="selectedCount">0 selected</span>
      </div>

      <div id="map" class="map"></div>

      <div class="map-view-footer">
        <div class="map-addresses-list" id="mapAddressesList">
          <!-- Selected addresses will appear here -->
        </div>
      </div>
    </div>

    <button id="generateBtn" class="btn btn-primary" style="margin-top: 12px;">
      Generate & Process <span id="addressCount">0</span> Houses
    </button>

    <!-- Progress Display -->
    <div class="progress-container" id="progressContainer">
      <div class="progress-text" id="progressText">Processing: 0/0</div>
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill"></div>
      </div>
    </div>

    <!-- Address List -->
    <div class="address-list" id="addressList">
      <!-- Dynamic content -->
    </div>

    <!-- PDF Generation -->
    <div class="pdf-section" id="pdfSection">
      <div class="pdf-ready">
        <span class="pdf-ready-icon">‚úÖ</span>
        <span class="pdf-ready-text" id="pdfReadyText">All addresses processed!</span>
      </div>
      <button id="generatePdfBtn" class="btn btn-primary">Generate 3√ó3 Grid PDF</button>
    </div>
  </div>

  <!-- Settings Tab -->
  <div id="settings-tab" class="tab-content">
    <h2>‚öôÔ∏è Settings</h2>

    <div class="form-group">
      <label for="proxyUrl">Proxy Server URL</label>
      <input type="text" id="proxyUrl" placeholder="http://localhost:3000">
    </div>

    <button id="saveSettingsBtn" class="btn btn-primary">Save Settings</button>

    <div class="proxy-status" id="proxyStatus">
      <span id="proxyStatusIcon">‚óè</span>
      <span id="proxyStatusText">Checking connection...</span>
    </div>

    <button id="openOptionsBtn" class="btn btn-secondary">Open Full Options</button>
  </div>

  <!-- Leaflet JS -->
  <script src="lib/leaflet.js"></script>
  <script src="popup.js"></script>
</body>
</html>
